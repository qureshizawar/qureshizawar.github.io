let model_depth;tf.setBackend("webgl"),tf.ENV.set("WEBGL_CONV_IM2COL",!1),tf.ENV.set("WEBGL_PACK",!1),tf.ENV.set("WEBGL_FORCE_F16_TEXTURES",!0),tf.enableProdMode();const input_res_lookup={scene_outdoors1_depth_low:[128,320],scene_outdoors1_depth_mid:[192,320],scene_outdoors1_depth_high:[192,640],scene_outdoors2_depth_low:[160,320],scene_outdoors2_depth_mid:[256,480],scene_outdoors2_depth_high:[320,640],scene_indoors_depth_low:[224,320],scene_indoors_depth_mid:[320,448],scene_indoors_depth_high:[416,544]};var curr_model="scene_outdoors2",curr_res="depth_mid",Depth_IMAGE_WIDTH=input_res_lookup[curr_model.concat("_").concat(curr_res)][1],Depth_IMAGE_HEIGHT=input_res_lookup[curr_model.concat("_").concat(curr_res)][0],output_HEIGHT=300,output_WIDTH=400;const status_depth=document.getElementById("status_depth"),dropdown_depth_qual=document.getElementById("dropdown_depth_qual"),depth_low=document.getElementById("depth_low"),depth_mid=document.getElementById("depth_mid"),depth_high=document.getElementById("depth_high");function custom_mgrid(e,t){return a=tf.tile(tf.range(0,e).reshape([e,1]),[1,t]),b=tf.tile(tf.range(0,t).expandDims(0),[e,1]),[a,b]}is_touch_device()||window.matchMedia("(max-device-width: 960px)").matches||(curr_res="depth_high",dropdown_depth_qual.textContent=depth_high.textContent,Depth_IMAGE_WIDTH=input_res_lookup[curr_model.concat("_").concat(curr_res)][1],Depth_IMAGE_HEIGHT=input_res_lookup[curr_model.concat("_").concat(curr_res)][0]),document.getElementById("files").addEventListener("change",(function(e){status_depth.textContent="Status: Loading...",file_infer(e.target.files[0],document.getElementById("inpimg"),status_depth,Depth_Demo)})),document.getElementById("depth_files_btn").addEventListener("click",(function(e){file=document.getElementById("files").files[0],null==file?status_depth.textContent="Status: File not found":(status_depth.textContent="Status: Loading...",file_infer(file,document.getElementById("inpimg"),status_depth,Depth_Demo))})),document.getElementById("select_files_btn").onclick=function(){status_depth.textContent="Status: Loading...",img_in=document.getElementById("inpimg"),Depth_Demo(img_in)},document.getElementById("url_btn").addEventListener("click",(function(e){status_depth.textContent="Status: Loading...",url_infer(document.getElementById("imagename"),document.getElementById("inpimg"),status_depth,Depth_Demo)}));const load_model=async e=>{model_depth="scene_indoors"==e?await tf.loadLayersModel("/assets/indoors_Mnet_tfjs_quant/model.json"):await tf.loadLayersModel("/assets/outdoors_Mnet_tfjs_quant/model.json")},DepthWarmup=async()=>{status_depth.textContent="Status: Loading...",model_depth=await tf.loadLayersModel("/assets/outdoors_Mnet_tfjs_quant/model.json"),inpElement=document.getElementById("inpimg"),inpElement.complete&&0!==inpElement.naturalHeight?(Depth_Demo(inpElement),inpElement.style.display=""):inpElement.onload=()=>{Depth_Demo(inpElement),inpElement.style.display=""}},Depth_Demo=async e=>{status_depth.textContent="Status: Loading...",output_WIDTH=e.clientWidth,output_HEIGHT=e.clientHeight;const t=tf.tidy(()=>{in_img=tf.browser.fromPixels(e).toFloat();const t=tf.image.resizeBilinear(in_img,[Depth_IMAGE_HEIGHT,Depth_IMAGE_WIDTH]),n=tf.scalar(255),o=tf.tensor3d([.485,.456,.406],[1,1,3]),d=tf.tensor3d([.229,.224,.225],[1,1,3]),i=t.div(n).sub(o).div(d);status_depth.textContent="Status: Model loaded! running inference";const r=i.expandDims(),c=model_depth.predict(r).squeeze(0),_=c.sub(c.min()).divNoNan(c.max().sub(c.min()));img_array=tf.image.resizeBilinear(in_img,[output_HEIGHT,output_WIDTH]).arraySync();const s=custom_mgrid(img_array.length,img_array[0].length);return xs_array=s[0].arraySync(),ys_array=s[1].arraySync(),tf.image.resizeBilinear(_,[output_HEIGHT,output_WIDTH])}),n=document.getElementById("depth");n.width=output_WIDTH,n.height=output_HEIGHT,depth_array=t.arraySync(),await tf.browser.toPixels(t,n),createPointCloud(xs_array,ys_array,depth_array,img_array),t.dispose(),status_depth.textContent="Status: Done!"};function set_model(e){event.preventDefault(),load_model(curr_model=e),Depth_IMAGE_WIDTH=input_res_lookup[curr_model.concat("_").concat(curr_res)][1],Depth_IMAGE_HEIGHT=input_res_lookup[curr_model.concat("_").concat(curr_res)][0],dropdown_scene.textContent=document.getElementById(e).textContent}function set_res(e){event.preventDefault(),curr_res=e,Depth_IMAGE_WIDTH=input_res_lookup[curr_model.concat("_").concat(curr_res)][1],Depth_IMAGE_HEIGHT=input_res_lookup[curr_model.concat("_").concat(curr_res)][0],dropdown_depth_qual.textContent=document.getElementById(e).textContent}const inpimg_lookup={inp_outdoors:"assets/demo_images/inp_outdoors.png",inp_indoors:"assets/demo_images/inp_indoors.jfif"};function inp_load(e){event.preventDefault(),document.getElementById("dropdown_input_out").textContent=document.getElementById(e).textContent,document.getElementById("inpimg").src=inpimg_lookup[e]}var filecheckBox=document.getElementById("fileinput"),urlcheckBox=document.getElementById("urlinput"),inp_selectcheckBox=document.getElementById("selectinput"),filecontainer=document.getElementById("file-container"),urlcontainer=document.getElementById("url-container"),dropdown_input=document.getElementById("dropdown_input");function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}inp_selectcheckBox.addEventListener("click",(function(){1==inp_selectcheckBox.checked&&(filecheckBox.checked=!1,urlcheckBox.checked=!1,dropdown_input.style.display="block",filecontainer.style.display="none",urlcontainer.style.display="none")})),filecheckBox.addEventListener("click",(function(){1==filecheckBox.checked&&(urlcheckBox.checked=!1,inp_selectcheckBox.checked=!1,filecontainer.style.display="block",urlcontainer.style.display="none",dropdown_input.style.display="none")})),urlcheckBox.addEventListener("click",(function(){1==urlcheckBox.checked&&(filecheckBox.checked=!1,inp_selectcheckBox.checked=!1,filecontainer.style.display="none",urlcontainer.style.display="block",dropdown_input.style.display="none")}));class MirrorPad extends tf.layers.Layer{constructor(e){super(e),this.pad0=e.padding[0],this.pad1=e.padding[1]}call(e,t){return e[0].mirrorPad([[0,0],this.pad0,this.pad1,[0,0]],"reflect")}}_defineProperty(MirrorPad,"className","MirrorPad"),tf.serialization.registerClass(MirrorPad);