function asyncGeneratorStep(e,t,n,o,r,a,d){try{var i=e[a](d),s=i.value}catch(e){return void n(e)}i.done?t(s):Promise.resolve(s).then(o,r)}function _asyncToGenerator(i){return function(){var e=this,d=arguments;return new Promise(function(t,n){var o=i.apply(e,d);function r(e){asyncGeneratorStep(o,t,n,r,a,"next",e)}function a(e){asyncGeneratorStep(o,t,n,r,a,"throw",e)}r(void 0)})}}var model_depth_encoder,model_depth_decoder;tf.setBackend("webgl"),tf.ENV.set("WEBGL_CONV_IM2COL",!1);var Depth_IMAGE_HEIGHT=192,Depth_IMAGE_WIDTH=320,cors_api_url="https://cors-anywhere.herokuapp.com/",status_depth=document.getElementById("status_depth"),dropdown_depth_qual=document.getElementById("dropdown_depth_qual"),depth_low=document.getElementById("depth_low"),depth_medium=document.getElementById("depth_medium"),depth_high=document.getElementById("depth_high");function is_touch_device(){return"ontouchstart"in window||"onmsgesturechange"in window}function depth_file(e){if(status_depth.textContent="Status: Fetching image...",window.File&&window.FileReader&&window.FileList&&window.Blob){var t=new FileReader;t.addEventListener("load",function(e){var t=e.target.result;window.loadImage(t,function(o){"error"===o.type?console.log("couldn't load image:",o):window.EXIF.getData(o,function(){console.log("done!");var e=window.EXIF.getTag(this,"Orientation"),t=window.loadImage.scale(o,{orientation:e||0,canvas:!0}),n=document.getElementById("inpimg");n.src=t.toDataURL(),n.onload=function(){return Depth_Demo(n)}})})}),t.readAsDataURL(e)}else console.log("The File APIs are not fully supported in this browser.")}function custom_mgrid(e,t){return a=tf.tile(tf.range(0,e).reshape([e,1]),[1,t]),b=tf.tile(tf.range(0,t).expandDims(0),[e,1]),[a,b]}is_touch_device()||window.matchMedia("(max-device-width: 960px)").matches||(Depth_IMAGE_HEIGHT=192,Depth_IMAGE_WIDTH=640,dropdown_depth_qual.textContent=depth_high.textContent),document.getElementById("files").addEventListener("change",function(e){depth_file(e.target.files[0])}),document.getElementById("depth_files_btn").addEventListener("click",function(e){file=document.getElementById("files").files[0],null==file?status_depth.textContent="Status: File not found":depth_file(file)}),document.getElementById("btn").onclick=function(){status_depth.textContent="Status: Fetching image...";var e=new URL(document.getElementById("imagename").value),t=new XMLHttpRequest;t.open("GET",cors_api_url+e,!0),t.responseType="blob",t.send(),t.onload=function(){var e=new FileReader;e.readAsDataURL(t.response),e.onload=function(e){var t=document.getElementById("inpimg");t.src=e.target.result,t.onload=function(){return Depth_Demo(t)}}}};var DepthWarmup=function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return status_depth.textContent="Status: Loading...",e.next=3,tf.loadLayersModel("/assets/tfjs_encoder_quant/model.json");case 3:return model_depth_encoder=e.sent,e.next=6,tf.loadLayersModel("/assets/tfjs_decoder_quant/model.json");case 6:model_depth_decoder=e.sent,(t=document.getElementById("inpimg")).complete&&0!==t.naturalHeight?(Depth_Demo(t),t.style.display=""):t.onload=function(){Depth_Demo(t),t.style.display=""},document.getElementById("file-container").style.display="";case 10:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),Depth_Demo=function(){var t=_asyncToGenerator(regeneratorRuntime.mark(function e(c){var u,t,n,o,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return u=0,status_depth.textContent="Status: Loading image into model...",in_img=tf.browser.fromPixels(c).toFloat(),t=tf.tidy(function(){var e=tf.image.resizeBilinear(tf.browser.fromPixels(c).toFloat(),[Depth_IMAGE_HEIGHT,Depth_IMAGE_WIDTH]),t=tf.scalar(255),n=e.div(t);status_depth.textContent="Status: Model loaded! running inference";var o=n.transpose([2,0,1]).expandDims(),r=performance.now(),a=model_depth_encoder.predict(o),d=model_depth_decoder.predict(a),i=performance.now();u=i-r;var s=d[3].squeeze(0).transpose([1,2,0]);return s.sub(s.min()).divNoNan(s.max().sub(s.min()))}),n=document.getElementById("depth"),t_Width=document.getElementById("inpimg").clientWidth,t_Height=document.getElementById("inpimg").clientHeight,o=tf.image.resizeBilinear(t,[t_Height,t_Width]),img_array=in_img.arraySync(),depth_array=o.arraySync(),e.next=12,tf.browser.toPixels(o,n);case 12:status_depth.textContent="Status: Done! inference took "+u.toFixed(1)+" milliseconds.",r=custom_mgrid(img_array.length,img_array[0].length),createPointCloud(r[0].arraySync(),r[1].arraySync(),depth_array,img_array);case 15:case"end":return e.stop()}},e)}));return function(e){return t.apply(this,arguments)}}();depth_low.onclick=function(){event.preventDefault(),Depth_IMAGE_HEIGHT=96,Depth_IMAGE_WIDTH=320,dropdown_depth_qual.textContent=depth_low.textContent},depth_medium.onclick=function(){event.preventDefault(),Depth_IMAGE_HEIGHT=192,Depth_IMAGE_WIDTH=320,dropdown_depth_qual.textContent=depth_medium.textContent},depth_high.onclick=function(){event.preventDefault(),Depth_IMAGE_HEIGHT=192,Depth_IMAGE_WIDTH=640,dropdown_depth_qual.textContent=depth_high.textContent},DepthWarmup();