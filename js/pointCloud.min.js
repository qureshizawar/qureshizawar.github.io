import{OrbitControls}from"./OrbitControls.min.js";import*as THREE from"./three.module.js";function createTextCanvas(e,n,t,r){r=r||16;var a=document.createElement("canvas"),o=a.getContext("2d"),i=r+"px "+(t||"Arial");o.font=i;var d=o.measureText(e).width,l=Math.ceil(r);return a.width=d,a.height=l,a.id="depth_canvas",o.font=i,o.fillStyle=n||"black",o.fillText(e,0,Math.ceil(.8*r)),a}function createText2D(e,n,t,r,a,o){var i=createTextCanvas(e,n,t,r),d=new THREE.PlaneGeometry(i.width,i.height,a,o),l=new THREE.Texture(i);l.needsUpdate=!0;var c=new THREE.MeshBasicMaterial({map:l,color:16777215,transparent:!0}),s=new THREE.Mesh(d,c);return s.scale.set(.5,.5,.5),s.doubleSided=!0,s}function hexToRgb(e){var n=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return n?{r:parseInt(n[1],16),g:parseInt(n[2],16),b:parseInt(n[3],16)}:null}function componentToHex(e){var n=e.toString(16);return 1==n.length?"0"+n:n}function rgbToHex(e,n,t){return"#"+componentToHex(e)+componentToHex(n)+componentToHex(t)}var renderer=new THREE.WebGLRenderer({antialias:!0});window.createPointCloud=function(e,n,t,r){var a,o=r[0].length,i=r.length;renderer.setSize(o,i),renderer.domElement.id="depth_canvas";var d=document.getElementById("mainImage"),l=document.getElementById("depth_canvas");renderer.setClearColor(15658734,1);var c=new THREE.Scene,s=new THREE.PerspectiveCamera(function(e,n){return 120.3704-e/n*36.41975+4.115226*Math.pow(e/n,2)}(o,i),o/i,1,1e4);s.position.z=200,s.position.x=100,s.position.y=100;var m=new THREE.Object3D;c.add(m),m.rotation.y=0;for(var E=[],u=(d3.format("+.3f"),0);u<e.length;u++)for(var h=0;h<e[0].length;h++)E[u*e[0].length+h]={x:n[u][h],y:-e[u][h],z:t[u][h],r:r[u][h][0],g:r[u][h][1],b:r[u][h][2]};var g=d3.extent(E,(function(e){return e.x})),p=d3.extent(E,(function(e){return e.y})),v=d3.extent(E,(function(e){return e.z})),x=(g[1],g[1],g[0],g[0],p[1],p[1],p[0],p[0],v[1],v[1],v[0],v[0],d3.scale.category20c(),d3.scale.linear().domain(g).range([-o/3,o/3])),T=d3.scale.linear().domain(p).range([-i/3,i/3]),f=d3.scale.linear().domain(v).range([-100,100]),w=new THREE.PointsMaterial({vertexColors:!0,size:.9*window.devicePixelRatio}),H=E.length,R=new THREE.Geometry;for(u=0;u<H;u++){var b=x(E[u].x),C=T(E[u].y),y=f(E[u].z);R.vertices.push(new THREE.Vector3(b,C,y)),R.colors.push((new THREE.Color).setRGB(E[u].r/255,E[u].g/255,E[u].b/255))}var P=new THREE.Points(R,w);m.add(P),d.replaceChild(renderer.domElement,l),(a=new OrbitControls(s,renderer.domElement)).enableDamping=!1,a.screenSpacePanning=!1,a.minDistance=100,a.maxDistance=500,a.maxPolarAngle=Math.PI/2,function e(){requestAnimationFrame(e),renderer.render(c,s)}()};