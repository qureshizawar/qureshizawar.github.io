import{OrbitControls}from"./OrbitControls.min.js";import*as THREE from"https://unpkg.com/three/build/three.module.js";window.createPointCloud=function(e,n,t,r){var a;var o=new THREE.WebGLRenderer({antialias:!0}),i=r[0].length,l=r.length;o.setSize(i,l),o.domElement.id="depth_canvas";var d=document.getElementById("mainImage"),s=document.getElementById("depth_canvas");o.setClearColor(15658734,1);var m=new THREE.Scene,c=new THREE.PerspectiveCamera(function(e,n){return 120.3704-e/n*36.41975+4.115226*Math.pow(e/n,2)}(i,l),i/l,1,1e4);c.position.z=200,c.position.x=100,c.position.y=100;var E=new THREE.Object3D;m.add(E),E.rotation.y=0;for(var g=[],u=(d3.format("+.3f"),0);u<e.length;u++)for(var h=0;h<e[0].length;h++)g[u*e[0].length+h]={x:n[u][h],y:-e[u][h],z:t[u][h],r:r[u][h][0],g:r[u][h][1],b:r[u][h][2]};var p=d3.extent(g,(function(e){return e.x})),v=d3.extent(g,(function(e){return e.y})),w=d3.extent(g,(function(e){return e.z})),f=(p[1],p[1],p[0],p[0],v[1],v[1],v[0],v[0],w[1],w[1],w[0],w[0],d3.scale.category20c(),d3.scale.linear().domain(p).range([-i/3,i/3])),R=d3.scale.linear().domain(v).range([-l/3,l/3]),x=d3.scale.linear().domain(w).range([-100,100]),C=new THREE.PointsMaterial({vertexColors:!0,size:.9*window.devicePixelRatio}),H=g.length,T=new THREE.Geometry;for(u=0;u<H;u++){var b=f(g[u].x),y=R(g[u].y),P=x(g[u].z);T.vertices.push(new THREE.Vector3(b,y,P)),T.colors.push((new THREE.Color).setRGB(g[u].r/255,g[u].g/255,g[u].b/255))}var z=new THREE.Points(T,C);E.add(z),d.replaceChild(o.domElement,s),(a=new OrbitControls(c,o.domElement)).enableDamping=!1,a.screenSpacePanning=!1,a.minDistance=100,a.maxDistance=500,a.maxPolarAngle=Math.PI/2,function e(){requestAnimationFrame(e),o.render(m,c)}()};