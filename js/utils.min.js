function isAndroid(){return/Android/i.test(navigator.userAgent)}function isiOS(){return/iPhone|iPad|iPod/i.test(navigator.userAgent)}function isMobile(){return isAndroid()||isiOS()}function toggleLoadingUI(t,e="loading",a="main"){t?(document.getElementById(e).style.display="block",document.getElementById(a).style.display="none"):(document.getElementById(e).style.display="none",document.getElementById(a).style.display="block")}function toTuple({y:t,x:e}){return[t,e]}async function renderToCanvas(t,e){const[a,n]=t.shape,i=new ImageData(n,a),r=await t.data();for(let t=0;t<a*n;++t){const e=4*t,a=3*t;i.data[e+0]=r[a+0],i.data[e+1]=r[a+1],i.data[e+2]=r[a+2],i.data[e+3]=255}e.putImageData(i,0,0)}function renderImageToCanvas(t,e,a){a.width=e[0],a.height=e[1],a.getContext("2d").drawImage(t,0,0)}function set_static_output_size(t){return t.clientWidth>t.naturalWidth&&t.clientHeight>t.naturalHeight?(output_HEIGHT=t.clientHeight,output_WIDTH=Math.round(t.naturalWidth/t.naturalHeight*output_HEIGHT),output_WIDTH>t.clientWidth&&(output_WIDTH=t.clientWidth,output_HEIGHT=Math.round(t.naturalHeight/t.naturalWidth*output_WIDTH))):t.clientWidth<t.naturalWidth&&t.clientHeight<t.naturalHeight?(output_WIDTH=t.clientWidth,output_HEIGHT=Math.round(t.naturalHeight/t.naturalWidth*output_WIDTH),output_HEIGHT>t.clientHeight&&(output_HEIGHT=t.clientHeight,output_WIDTH=Math.round(t.naturalWidth/t.naturalHeight*output_HEIGHT))):t.clientWidth<t.naturalWidth?(output_WIDTH=t.clientWidth,output_HEIGHT=Math.round(t.naturalHeight/t.naturalWidth*output_WIDTH)):(output_HEIGHT=t.clientHeight,output_WIDTH=Math.round(t.naturalWidth/t.naturalHeight*output_HEIGHT)),[output_WIDTH,output_HEIGHT]}function file_load(t,e,a){if(a.textContent="Status: Fetching image...",window.File&&window.FileReader&&window.FileList&&window.Blob){var n=new FileReader;n.addEventListener("load",(function(t){e.src=t.target.result})),n.readAsDataURL(t)}else console.log("The File APIs are not fully supported in this browser.")}function url_load(t,e,a){a.textContent="Status: Fetching image...";let n=new URL(t.value);var i=new XMLHttpRequest;i.open("GET",cors_api_url+n,!0),i.responseType="blob",i.send(),i.onload=function(){var t=new FileReader;t.readAsDataURL(i.response),t.onload=t=>{e.src=t.target.result}}}function file_infer(t,e,a,n){if(a.textContent="Status: Fetching image...",window.File&&window.FileReader&&window.FileList&&window.Blob){var i=new FileReader;i.addEventListener("load",(function(t){e.src=t.target.result,e.onload=()=>n(e)})),i.readAsDataURL(t)}else console.log("The File APIs are not fully supported in this browser.")}function url_infer(t,e,a,n){a.textContent="Status: Fetching image...";let i=new URL(t.value);var r=new XMLHttpRequest;r.open("GET",cors_api_url+i,!0),r.responseType="blob",r.send(),r.onload=function(){var t=new FileReader;t.readAsDataURL(r.response),t.onload=t=>{e.src=t.target.result,e.onload=()=>n(e)}}}async function setupCamera(t){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Error("Browser API navigator.mediaDevices.getUserMedia not available");const e=document.getElementById("video"),a=await navigator.mediaDevices.getUserMedia({audio:!1,video:{facingMode:"rear"==t?"environment":"user",frameRate:{ideal:30,max:35}}});return e.srcObject=a,new Promise(t=>{e.onloadedmetadata=()=>{t(e)}})}async function loadVideo(t){const e=await setupCamera(t);return e.play(),e}function getImageUrl(t,e){return readOrientation(t).then((function(a){return applyRotation(t,a||1,e||999999)}))}var readOrientation=function(t){return new Promise((function(e){var a=new FileReader;a.onload=function(){return e(function(){var t=new DataView(a.result);if(65496==t.getUint16(0,!1))for(var e=t.byteLength,n=2;n<e;){var i=t.getUint16(n,!1);if(n+=2,65505==i){if(n+=2,1165519206!=t.getUint32(n,!1))return;n+=6;var r=18761==t.getUint16(n,!1);n+=t.getUint32(n+4,r);var o=t.getUint16(n,r);n+=2;for(var u=0;u<o;u++)if(274==t.getUint16(n+12*u,r))return t.getUint16(n+12*u+8,r)}else{if(65280!=(65280&i))break;n+=t.getUint16(n,!1)}}}())},a.readAsArrayBuffer(t.slice(0,65536))}))},applyRotation=function(t,e,a){return new Promise((function(n){var i=new FileReader;i.onload=function(){var t=i.result,r=new Image;r.onload=function(){var t=document.createElement("canvas"),i=t.getContext("2d"),o=r.width,u=r.height,d=e>=5&&e<=8?[u,o]:[o,u],l=d[0],s=d[1],c=l>a?a/l:1;o=Math.floor(o*c),u=Math.floor(u*c);var g=Math.max(o,u);t.width=g,t.height=g;var h=!1,f=!1;switch(e){case 2:i.transform(-1,0,0,1,g,0),h=!0;break;case 3:i.transform(-1,0,0,-1,g,g),h=!0,f=!0;break;case 4:i.transform(1,0,0,-1,0,g),f=!0;break;case 5:i.transform(0,1,1,0,0,0);break;case 6:i.transform(0,1,-1,0,g,0),h=!0;break;case 7:i.transform(0,-1,-1,0,g,g),h=!0,f=!0;break;case 8:i.transform(0,-1,1,0,0,g),f=!0}i.drawImage(r,0,0,o,u);var p=document.createElement("canvas");p.width=Math.floor(l*c),p.height=Math.floor(s*c);var w=p.getContext("2d"),m=h?t.width-p.width:0,H=f?t.height-p.height:0;w.drawImage(t,m,H,p.width,p.height,0,0,p.width,p.height),n(p.toDataURL("image/jpeg"))},r.src=t},i.readAsDataURL(t)}))};