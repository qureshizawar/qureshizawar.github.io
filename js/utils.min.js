const cors_api_url="https://cors-anywhere.herokuapp.com/";function isAndroid(){return/Android/i.test(navigator.userAgent)}function isiOS(){return/iPhone|iPad|iPod/i.test(navigator.userAgent)}function isMobile(){return isAndroid()||isiOS()}function is_touch_device(){return"ontouchstart"in window||"onmsgesturechange"in window}function toggleLoadingUI(t,e="loading",n="main"){t?(document.getElementById(e).style.display="block",document.getElementById(n).style.display="none"):(document.getElementById(e).style.display="none",document.getElementById(n).style.display="block")}function toTuple({y:t,x:e}){return[t,e]}async function renderToCanvas(t,e){const[n,a]=t.shape,i=new ImageData(a,n),r=await t.data();for(let t=0;t<n*a;++t){const e=4*t,n=3*t;i.data[e+0]=r[n+0],i.data[e+1]=r[n+1],i.data[e+2]=r[n+2],i.data[e+3]=255}e.putImageData(i,0,0)}function renderImageToCanvas(t,e,n){n.width=e[0],n.height=e[1],n.getContext("2d").drawImage(t,0,0)}function set_static_output_size(t){return t.clientWidth>t.naturalWidth&&t.clientHeight>t.naturalHeight?(output_HEIGHT=t.clientHeight,output_WIDTH=Math.round(t.naturalWidth/t.naturalHeight*output_HEIGHT),output_WIDTH>t.clientWidth&&(output_WIDTH=t.clientWidth,output_HEIGHT=Math.round(t.naturalHeight/t.naturalWidth*output_WIDTH))):t.clientWidth<t.naturalWidth&&t.clientHeight<t.naturalHeight?(output_WIDTH=t.clientWidth,output_HEIGHT=Math.round(t.naturalHeight/t.naturalWidth*output_WIDTH),output_HEIGHT>t.clientHeight&&(output_HEIGHT=t.clientHeight,output_WIDTH=Math.round(t.naturalWidth/t.naturalHeight*output_HEIGHT))):t.clientWidth<t.naturalWidth?(output_WIDTH=t.clientWidth,output_HEIGHT=Math.round(t.naturalHeight/t.naturalWidth*output_WIDTH)):(output_HEIGHT=t.clientHeight,output_WIDTH=Math.round(t.naturalWidth/t.naturalHeight*output_HEIGHT)),[output_WIDTH,output_HEIGHT]}function file_load(t,e,n){if(n.textContent="Status: Fetching image...",window.File&&window.FileReader&&window.FileList&&window.Blob){var a=new FileReader;a.addEventListener("load",(function(t){e.src=t.target.result})),a.readAsDataURL(t)}else console.log("The File APIs are not fully supported in this browser.")}function url_load(t,e,n){n.textContent="Status: Fetching image...";let a=new URL(t.value);var i=new XMLHttpRequest;i.open("GET",cors_api_url+a,!0),i.responseType="blob",i.send(),i.onload=function(){var t=new FileReader;t.readAsDataURL(i.response),t.onload=t=>{e.src=t.target.result}}}function file_infer(t,e,n,a){if(n.textContent="Status: Fetching image...",window.File&&window.FileReader&&window.FileList&&window.Blob){var i=new FileReader;i.addEventListener("load",(function(t){e.src=t.target.result,e.onload=()=>a(e)})),i.readAsDataURL(t)}else console.log("The File APIs are not fully supported in this browser.")}function url_infer(t,e,n,a){n.textContent="Status: Fetching image...";let i=new URL(t.value);var r=new XMLHttpRequest;r.open("GET",cors_api_url+i,!0),r.responseType="blob",r.send(),r.onload=function(){var t=new FileReader;t.readAsDataURL(r.response),t.onload=t=>{e.src=t.target.result,e.onload=()=>a(e)}}}async function setupCamera(t){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Error("Browser API navigator.mediaDevices.getUserMedia not available");const e=document.getElementById("video"),n=await navigator.mediaDevices.getUserMedia({audio:!1,video:{facingMode:"rear"==t?"environment":"user",frameRate:{ideal:30,max:35}}});return e.srcObject=n,new Promise(t=>{e.onloadedmetadata=()=>{t(e)}})}async function loadVideo(t){const e=await setupCamera(t);return e.play(),e}function getImageUrl(t,e){return readOrientation(t).then((function(n){return applyRotation(t,n||1,e||999999)}))}var readOrientation=function(t){return new Promise((function(e){var n=new FileReader;n.onload=function(){return e(function(){var t=new DataView(n.result);if(65496==t.getUint16(0,!1))for(var e=t.byteLength,a=2;a<e;){var i=t.getUint16(a,!1);if(a+=2,65505==i){if(a+=2,1165519206!=t.getUint32(a,!1))return;a+=6;var r=18761==t.getUint16(a,!1);a+=t.getUint32(a+4,r);var o=t.getUint16(a,r);a+=2;for(var u=0;u<o;u++)if(274==t.getUint16(a+12*u,r))return t.getUint16(a+12*u+8,r)}else{if(65280!=(65280&i))break;a+=t.getUint16(a,!1)}}}())},n.readAsArrayBuffer(t.slice(0,65536))}))},applyRotation=function(t,e,n){return new Promise((function(a){var i=new FileReader;i.onload=function(){var t=i.result,r=new Image;r.onload=function(){var t=document.createElement("canvas"),i=t.getContext("2d"),o=r.width,u=r.height,d=e>=5&&e<=8?[u,o]:[o,u],l=d[0],s=d[1],c=l>n?n/l:1;o=Math.floor(o*c),u=Math.floor(u*c);var h=Math.max(o,u);t.width=h,t.height=h;var g=!1,f=!1;switch(e){case 2:i.transform(-1,0,0,1,h,0),g=!0;break;case 3:i.transform(-1,0,0,-1,h,h),g=!0,f=!0;break;case 4:i.transform(1,0,0,-1,0,h),f=!0;break;case 5:i.transform(0,1,1,0,0,0);break;case 6:i.transform(0,1,-1,0,h,0),g=!0;break;case 7:i.transform(0,-1,-1,0,h,h),g=!0,f=!0;break;case 8:i.transform(0,-1,1,0,0,h),f=!0}i.drawImage(r,0,0,o,u);var p=document.createElement("canvas");p.width=Math.floor(l*c),p.height=Math.floor(s*c);var w=p.getContext("2d"),m=g?t.width-p.width:0,H=f?t.height-p.height:0;w.drawImage(t,m,H,p.width,p.height,0,0,p.width,p.height),a(p.toDataURL("image/jpeg"))},r.src=t},i.readAsDataURL(t)}))};

