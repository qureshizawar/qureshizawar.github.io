tf.setBackend("webgl"),tf.ENV.set("WEBGL_PACK",!1),tf.webgl.forceHalfFloat();var videoWidth=400,videoHeight=300;const IMAGE_WIDTH=224,IMAGE_HEIGHT=224;var mode="user";const mobile=isMobile();var cors_api_url="https://cors-anywhere.herokuapp.com/";let model_classifier;const status_classifier=document.getElementById("status_classifier");async function setupCamera(e){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Error("Browser API navigator.mediaDevices.getUserMedia not available");const t=document.getElementById("video");t.width=videoWidth,t.height=videoHeight;const i=await navigator.mediaDevices.getUserMedia({audio:!1,video:{facingMode:"rear"==e?"environment":"user",width:mobile?void 0:videoWidth,height:mobile?void 0:videoHeight}});return t.srcObject=i,new Promise(e=>{t.onloadedmetadata=()=>{e(t)}})}async function loadVideo(e){const t=await setupCamera(e);return t.play(),t}function classifier_file(e){if(status_classifier.textContent="Status: Fetching image...",window.File&&window.FileReader&&window.FileList&&window.Blob){var t=new FileReader;t.addEventListener("load",(function(e){const t=e.target.result;window.loadImage(t,(function(e){"error"===e.type?console.log("couldn't load image:",e):window.EXIF.getData(e,(function(){var t=window.EXIF.getTag(this,"Orientation"),i=window.loadImage.scale(e,{orientation:t||0,canvas:!0});let n=document.getElementById("inpimg0");n.src=i.toDataURL(),n.onload=()=>classifier_Demo(n)}))}))})),t.readAsDataURL(e)}else console.log("The File APIs are not fully supported in this browser.")}document.getElementById("files0").addEventListener("change",(function(e){classifier_file(e.target.files[0])})),document.getElementById("classifier_files_btn").addEventListener("click",(function(e){file=document.getElementById("files0").files[0],null==file?status_classifier.textContent="Status: File not found":classifier_file(file)})),document.getElementById("btn0").onclick=function(){status_classifier.textContent="Status: Fetching image...";let e=new URL(document.getElementById("imagename0").value);var t=new XMLHttpRequest;t.open("GET",cors_api_url+e,!0),t.responseType="blob",t.send(),t.onload=function(){var e=new FileReader;e.readAsDataURL(t.response),e.onload=e=>{let t=document.getElementById("inpimg0");t.src=e.target.result,t.onload=()=>classifier_Demo(t)}}};const ClassiferWarmup=async()=>{status_classifier.textContent="Status: Loading...",model_classifier=await tf.loadGraphModel("/assets/tfjs_model/model.json");const e=document.getElementById("inpimg0");e.complete&&0!==e.naturalHeight?(classifier_Demo(e),e.style.display=""):e.onload=()=>{classifier_Demo(e),e.style.display=""},document.getElementById("file-container").style.display=""},classifier_Demo=async e=>{status_classifier.textContent="Status: Loading image into model...";const t=tf.tidy(()=>{const t=tf.browser.fromPixels(e).toFloat().resizeBilinear([224,224]),i=tf.scalar(255),n=tf.tensor3d([.485,.456,.406],[1,1,3]),o=tf.tensor3d([.229,.224,.225],[1,1,3]),a=t.div(i).sub(n).div(o);status_classifier.textContent="Status: Model loaded! running inference";const d=a.transpose([0,1,2]).expandDims();return it0=performance.now(),model_classifier.predict(d).arraySync()});it1=performance.now();var i=[];i.push(["bus",t[0][0]]),i.push(["car",t[0][1]]),i.push(["pickup",t[0][2]]),i.push(["truck",t[0][3]]),i.push(["van",t[0][4]]),i.sort((function(e,t){return t[1]-e[1]})),document.getElementById("classifier_out1").innerHTML=i[0][0]+": "+(100*i[0][1]).toFixed(2)+"%",document.getElementById("classifier_out2").innerHTML=i[1][0]+": "+(100*i[1][1]).toFixed(2)+"%",document.getElementById("classifier_out3").innerHTML=i[2][0]+": "+(100*i[2][1]).toFixed(2)+"%",status_classifier.textContent="Status: Done! inference took "+(it1-it0).toFixed(1)+" ms."};let request,video;function detectInRealTime(e){const t=document.getElementById("output"),i=t.getContext("2d"),n="rear"!=mode;t.width=videoWidth,t.height=videoHeight,async function t(){i.clearRect(0,0,videoWidth,videoHeight),e.onloadeddata=()=>{camloaded=!0},camloaded&&(await classifier_Demo(e),i.save(),n&&(i.scale(-1,1),i.translate(-videoWidth,0)),i.drawImage(e,0,0,videoWidth,videoHeight),i.restore()),request=requestAnimationFrame(t)}()}async function bindPage(){camloaded=!1;try{video=await loadVideo(mode)}catch(e){let t=document.getElementById("info");throw t.textContent="this browser does not support video capture,or this device does not have a camera",t.style.display="block",e}detectInRealTime(video)}var filecheckBox=document.getElementById("fileinput"),urlcheckBox=document.getElementById("urlinput"),filecontainer=document.getElementById("file-container"),urlcontainer=document.getElementById("url-container");filecheckBox.addEventListener("click",(function(){1==filecheckBox.checked?(urlcheckBox.checked=!1,filecontainer.style.display="block",urlcontainer.style.display="none"):(urlcheckBox.checked=!0,filecontainer.style.display="none",urlcontainer.style.display="block")})),urlcheckBox.addEventListener("click",(function(){1==urlcheckBox.checked?(filecheckBox.checked=!1,filecontainer.style.display="none",urlcontainer.style.display="block"):(filecheckBox.checked=!0,filecontainer.style.display="block",urlcontainer.style.display="none")})),navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia;var camloaded=!1;function showfps(){var e=document.getElementById("show_fps"),t=document.getElementById("fps");1==e.checked?t.style.display="block":t.style.display="none"}function setmode(){mode=1==document.getElementById("camMode").checked?"rear":"user",1==document.getElementById("webcamc").checked&&(video.srcObject.getTracks().forEach((function(e){e.stop()})),cancelAnimationFrame(request),bindPage())}function webc(){var e=document.getElementById("imagec"),t=document.getElementById("webcamc"),i=document.getElementById("mainImage"),n=document.getElementById("mainVideo");if(1==t.checked)document.getElementById("camswitch").style.display="block",e.checked=!1,t_Width=document.getElementById("mainopt").clientWidth,t_Height=300,i.style.display="none",document.getElementById("main").style.display="block",n.style.display="block",apectWidth=4/3*t_Height,videoWidth=apectWidth>t_Width?t_Width:apectWidth,videoHeight=t_Height,camloaded=!1,bindPage();else{document.getElementById("camswitch").style.display="none",cancelAnimationFrame(request),video.srcObject.getTracks().forEach((function(e){e.stop()})),document.getElementById("output").getContext("2d").clearRect(0,0,videoWidth,videoHeight),n.style.display="none",document.getElementById("main").style.display="none"}}function imagec(){var e=document.getElementById("imagec"),t=document.getElementById("webcamc"),i=document.getElementById("mainImage"),n=document.getElementById("inpimg0"),o=document.getElementById("mainVideo");1==e.checked?(1==t.checked&&(document.getElementById("camswitch").style.display="none",t.checked=!1,cancelAnimationFrame(request),video.srcObject.getTracks().forEach((function(e){e.stop()}))),document.getElementById("main").style.display="block",i.style.display="block",o.style.display="none",n.src="/assets/demo_images/box_6109.jpg",ClassiferWarmup()):(i.style.display="none",document.getElementById("main").style.display="none")}ClassiferWarmup();